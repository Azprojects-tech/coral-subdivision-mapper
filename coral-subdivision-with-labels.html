<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Coral Subdivision Mapper - With Plot Labels</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1000;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        select {
            padding: 8px 15px;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            background: white;
            font-size: 14px;
            min-width: 120px;
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        #map {
            height: calc(100vh - 140px);
            width: 100%;
        }
        
        .legend {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 200px;
        }
        
        .legend h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
            border: 2px solid rgba(0,0,0,0.2);
        }
        
        .parcel-popup {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .parcel-popup h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .parcel-popup p {
            margin-bottom: 5px;
            color: #555;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: 10px;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-reserved {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-sold {
            background: #f8d7da;
            color: #721c24;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 2000;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Plot label styles */
        .plot-label {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #2c3e50;
            border-radius: 15px;
            padding: 4px 8px;
            font-weight: bold;
            font-size: 12px;
            color: #2c3e50;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            white-space: nowrap;
        }
        
        .label-control {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .label-control:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .label-control.active {
            background: linear-gradient(135deg, #dc3545 0%, #e63946 100%);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1> Coral Subdivision</h1>
        <p>Interactive Real Estate Parcel Viewer - Jeff Realty (With Plot Labels)</p>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading subdivision data with plot labels...</p>
    </div>
    
    <div id="map"></div>
    
    <div class="legend">
        <h4> Parcel Status</h4>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #28a745;"></div>
            <span>Available</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ffc107;"></div>
            <span>Reserved</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #dc3545;"></div>
            <span>Sold</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #6c757d;"></div>
            <span>Not Available</span>
        </div>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <button class="btn" id="mapBtn" onclick="toggleLayer('map')"> Map View</button>
            <button class="btn active" id="satelliteBtn" onclick="toggleLayer('satellite')"> Satellite</button>
        </div>
        
        <div class="control-group">
            <button class="label-control" id="labelsBtn" onclick="toggleLabels()"> Show Plot Numbers</button>
            <button class="btn" onclick="locateUser()"> My Location</button>
            <button class="btn" onclick="zoomToSubdivision()"> Zoom to Subdivision</button>
        </div>
        
        <div class="control-group admin-panel" style="margin-left: auto;">
            <label for="parcelSelect" style="color: #2c3e50; font-weight: 600;">Admin Panel:</label>
            <select id="parcelSelect" onchange="selectParcel()">
                <option value="">Select Parcel...</option>
            </select>
            <select id="statusSelect" onchange="updateParcelStatus()">
                <option value="available">Available</option>
                <option value="reserved">Reserved</option>
                <option value="sold">Sold</option>
            </select>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <script>
        // Embedded WGS84 GeoJSON data
        const subdivisionData = {"type":"FeatureCollection","features":[{"type":"Feature","id":0,"geometry":{"type":"Polygon","coordinates":[[[7.530758783667439,6.5965077198860342],[7.5306122805223881,6.5965385451197527],[7.5305781733578367,6.5965180757129263],[7.5305341643115211,6.5963663829172328],[7.5305531535709394,6.5963347415576257],[7.5306996566504312,6.596303917232885],[7.530758783667439,6.5965077198860342]]]},"properties":{"FID":0,"Text":"              P80","Shape_Leng":82.521059743500004,"Shape_Area":448.61074333800002}},{"type":"Feature","id":1,"geometry":{"type":"Polygon","coordinates":[[[7.5309362730609033,6.5964703762177077],[7.530758783667439,6.5965077198860342],[7.5306996566504312,6.596303917232885],[7.5307698401454868,6.5962891511933401],[7.5308771459677022,6.5962665735702144],[7.5309362730609033,6.5964703762177077]]]},"properties":{"FID":1,"Text":"              P79","Shape_Leng":87.044595452400003,"Shape_Area":469.31820235700002}},{"type":"Feature","id":2,"geometry":{"type":"Polygon","coordinates":[[[7.531108527957441,6.5964149903439626],[7.5311010745899551,6.5964195478658221],[7.5310944210205211,6.5964252083010795],[7.5310887277194789,6.596431834665804],[7.5310841335252956,6.5964392654957171],[7.5309362730609033,6.5964703762177077],[7.5308771459677022,6.5962665735702144],[7.5310546352744279,6.5962292289340834],[7.531108527957441,6.5964149903439626]]]},"properties":{"FID":2,"Text":"              P78","Shape_Leng":85.483440563399995,"Shape_Area":465.136302355}},{"type":"Feature","id":3,"geometry":{"type":"Polygon","coordinates":[[[7.5312912518108579,6.5963956877692915],[7.531169178101794,6.5964213726316201],[7.5311615743672178,6.5964161901836746],[7.5311532243012591,6.5964123231317249],[7.5311443536839855,6.5964098743289359],[7.5311352019642159,6.5964089114002622],[7.5311260168521867,6.5964094603963241],[7.5311170443746995,6.5964115048597192],[7.531108527957441,6.5964149903439626],[7.5310546352744279,6.5962292289340834],[7.5312321236609501,6.5961918851304553],[7.5312912518108579,6.5963956877692915]]]},"properties":{"FID":3,"Text":"              P77","Shape_Leng":85.828190343900005,"Shape_Area":458.36764058199998}},{"type":"Feature","id":4,"geometry":{"type":"Polygon","coordinates":[[[7.5314687402603671,6.5963583438908513],[7.5312912518108579,6.5963956877692915],[7.5312321236609501,6.5961918851304553],[7.5314096129385923,6.5961545412603577],[7.5314687402603671,6.5963583438908513]]]},"properties":{"FID":4,"Text":"              P76","Shape_Leng":87.044525799400006,"Shape_Area":469.317854195}},{"type":"Feature","id":5,"geometry":{"type":"Polygon","coordinates":[[[7.5316542170931458,6.5963193188215996],[7.5314687402603671,6.5963583438908513],[7.5314096129385923,6.5961545412603577],[7.531486745992277,6.5961383115869534],[7.5315685410479993,6.5961211017803123],[7.5316026482446876,6.596141571122681],[7.5316542170931458,6.5963193188215996]]]},"properties":{"FID":5,"Text":"              P75","Shape_Leng":87.248485529099995,"Shape_Area":485.952603802}},{"type":"Feature","id":6,"geometry":{"type":"Polygon","coordinates":[[[7.5315432727495688,6.5960340064403491],[7.5313265862846697,6.5960795980858702],[7.5312924782028654,6.5960591287253534],[7.5312616299067896,6.5959527992400089],[7.5315314135769444,6.5958960364483454],[7.5315622619334377,6.5960023659292162],[7.5315432727495688,6.5960340064403491]]]},"properties":{"FID":6,"Text":"              P100","Shape_Leng":87.936343113800007,"Shape_Area":454.407160025}},{"type":"Feature","id":7,"geometry":{"type":"Polygon","coordinates":[[[7.5315314135769444,6.5958960364483454],[7.5312616299067896,6.5959527992400089],[7.5312232221837609,6.5958204148262594],[7.5314930057787031,6.595763652040187],[7.5315314135769444,6.5958960364483454]]]},"properties":{"FID":7,"Text":"              P101","Shape_Leng":91.457023561599996,"Shape_Area":463.38182565800003}},{"type":"Feature","id":8,"geometry":{"type":"Polygon","coordinates":[[[7.5314930057787031,6.595763652040187],[7.5312232221837609,6.5958204148262594],[7.5311848153783281,6.5956880304160403],[7.5314545979963814,6.5956312667285832],[7.5314930057787031,6.595763652040187]]]},"properties":{"FID":8,"Text":"              P115","Shape_Leng":91.457014458700002,"Shape_Area":463.38248134700001}},{"type":"Feature","id":9,"geometry":{"type":"Polygon","coordinates":[[[7.5314545979963814,6.5956312667285832],[7.5311848153783281,6.5956880304160403],[7.5311464076845009,6.5955556450997488],[7.5314161902246708,6.5954988823221905],[7.5314545979963814,6.5956312667285832]]]},"properties":{"FID":9,"Text":"              P116","Shape_Leng":91.456944803100001,"Shape_Area":463.38206818800001}},{"type":"Feature","id":10,"geometry":{"type":"Polygon","coordinates":[[[7.5314161902246708,6.5954988823221905],[7.5311464076845009,6.5955556450997488],[7.5311080000012645,6.5954232606886345],[7.531377783370548,6.5953664979193434],[7.5314161902246708,6.5954988823221905]]]},"properties":{"FID":10,"Text":"              P130","Shape_Leng":91.456897621400003,"Shape_Area":463.38077611900002}},{"type":"Feature","id":11,"geometry":{"type":"Polygon","coordinates":[[[7.5312008132127497,6.5976678188101969],[7.5310659213340942,6.5976961995733365],[7.5309891059484837,6.5974314306978972],[7.5311239986588951,6.5974030490387046],[7.5312008132127497,6.5976678188101969]]]},"properties":{"FID":11,"Text":"              P24","Shape_Leng":91.457008305000002,"Shape_Area":463.38241191200001}},{"type":"Feature","id":12,"geometry":{"type":"Polygon","coordinates":[[[7.5311239986588951,6.5974030490387046],[7.5309891059484837,6.5974314306978972],[7.5309122915229452,6.5971666609243442],[7.5310471832537864,6.5971382792680791],[7.5311239986588951,6.5974030490387046]]]},"properties":{"FID":12,"Text":"              P38","Shape_Leng":91.4571251399,"Shape_Area":463.38358627500003}},{"type":"Feature","id":13,"geometry":{"type":"Polygon","coordinates":[[[7.5312588904573419,6.5973746673368838],[7.5311239986588951,6.5974030490387046],[7.5310471832537864,6.5971382792680791],[7.5311820749743319,6.5971098984761598],[7.5312588904573419,6.5973746673368838]]]},"properties":{"FID":13,"Text":"              P39","Shape_Leng":91.456938654400005,"Shape_Area":463.38110837300002}},{"type":"Feature","id":14,"geometry":{"type":"Polygon","coordinates":[[[7.5313357050864358,6.5976394371027842],[7.5312008132127497,6.5976678188101969],[7.5311239986588951,6.5974030490387046],[7.5312588904573419,6.5973746673368838],[7.5313357050864358,6.5976394371027842]]]},"properties":{"FID":14,"Text":"              P23","Shape_Leng":91.456999197900004,"Shape_Area":463.38196449399999}},{"type":"Feature","id":15,"geometry":{"type":"Polygon","coordinates":[[[7.5314705978568206,6.5976110553581053],[7.5313357050864358,6.5976394371027842],[7.5312588904573419,6.5973746673368838],[7.5313937822481538,6.5973462855951359],[7.5314705978568206,6.5976110553581053]]]},"properties":{"FID":15,"Text":"              P22","Shape_Leng":91.4571251399,"Shape_Area":463.38358627500003}},{"type":"Feature","id":16,"geometry":{"type":"Polygon","coordinates":[[[7.5313937822481538,6.5973462855951359],[7.5312588904573419,6.5973746673368838],[7.5311820749743319,6.5971098984761598],[7.5312708288356944,6.5970912243618232],[7.5312769273134634,6.5970971755702639],[7.5312838570866925,6.59710213357085],[7.5312914593323628,6.5971059830470411],[7.5312995579679551,6.5971086348567578],[7.5313079641678069,6.5971100278543142],[7.5313164854063634,6.5971101289170679],[7.5313249227318684,6.597108937458958],[7.5313937822481538,6.5973462855951359]]]},"properties":{"FID":16,"Text":"              P40","Shape_Leng":89.681916383100003,"Shape_Area":451.596033073}},{"type":"Feature","id":17,"geometry":{"type":"Polygon","coordinates":[[[7.5315286740286673,6.5973179047177526],[7.5313937822481538,6.5973462855951359],[7.5313249227318684,6.597108937458958],[7.5313329458309184,6.5971065320872251],[7.5313405211128739,6.5971029570146174],[7.5313474783273469,6.5970982922241825],[7.5313536625256043,6.5970926421606633],[7.5313589349701884,6.5970861339246021],[7.5313631785768678,6.5970789118623872],[7.5313662970103419,6.5970711375636446],[7.531451859302182,6.5970531349665702],[7.5315286740286673,6.5973179047177526]]]},"properties":{"FID":17,"Text":"              P41","Shape_Leng":89.209179138500005,"Shape_Area":451.20072944600003}},{"type":"Feature","id":18,"geometry":{"type":"Polygon","coordinates":[[[7.5316054897152345,6.597582673570801],[7.5314705978568206,6.5976110553581053],[7.5313937822481538,6.5973462855951359],[7.5315286740286673,6.5973179047177526],[7.5316054897152345,6.597582673570801]]]},"properties":{"FID":18,"Text":"              P21","Shape_Leng":91.456938652299996,"Shape_Area":463.38110835100002}},{"type":"Feature","id":19,"geometry":{"type":"Polygon","coordinates":[[[7.5317403815633508,6.5975542926478754],[7.5316054897152345,6.597582673570801],[7.5315286740286673,6.5973179047177526],[7.5316635667085423,6.5972895228987625],[7.5317403815633508,6.5975542926478754]]]},"properties":{"FID":19,"Text":"              P20","Shape_Leng":91.457008303600006,"Shape_Area":463.38241190600002}},{"type":"Feature","id":20,"geometry":{"type":"Polygon","coordinates":[[[7.5316635667085423,6.5972895228987625],[7.5315286740286673,6.5973179047177526],[7.531451859302182,6.5970531349665702],[7.5315867510024894,6.5970247531505111],[7.5316635667085423,6.5972895228987625]]]},"properties":{"FID":20,"Text":"              P42","Shape_Leng":91.457125140700001,"Shape_Area":463.38358629099997}},{"type":"Feature","id":21,"geometry":{"type":"Polygon","coordinates":[[[7.5317984584764499,6.5972611410371806],[7.5316635667085423,6.5972895228987625],[7.5315867510024894,6.5970247531505111],[7.5317216426925002,6.5969963721988369],[7.5317984584764499,6.5972611410371806]]]},"properties":{"FID":21,"Text":"              P43","Shape_Leng":91.456938653700007,"Shape_Area":463.38110835700002}},{"type":"Feature","id":22,"geometry":{"type":"Polygon","coordinates":[[[7.5318752734064933,6.5975259107806954],[7.5317403815633508,6.5975542926478754],[7.5316635667085423,6.5972895228987625],[7.5317984584764499,6.5972611410371806],[7.5318752734064933,6.5975259107806954]]]},"properties":{"FID":22,"Text":"              P19","Shape_Leng":91.456999197200005,"Shape_Area":463.38196447799999}},{"type":"Feature","id":23,"geometry":{"type":"Polygon","coordinates":[[[7.5319968542336424,6.5975003292475005],[7.5318752734064933,6.5975259107806954],[7.5317984584764499,6.5972611410371806],[7.5319200383287992,6.59723556041068],[7.5319968542336424,6.5975003292475005]]]},"properties":{"FID":23,"Text":"              P18","Shape_Leng":88.448532805499994,"Shape_Area":417.653725936}},{"type":"Feature","id":24,"geometry":{"type":"Polygon","coordinates":[[[7.5319200383287992,6.59723556041068],[7.5317984584764499,6.5972611410371806],[7.5317216426925002,6.5969963721988369],[7.5318432233840298,6.5969707906757344],[7.5319200383287992,6.59723556041068]]]},"properties":{"FID":24,"Text":"              P44","Shape_Leng":88.448532806100005,"Shape_Area":417.65372593799998}},{"type":"Feature","id":25,"geometry":{"type":"Polygon","coordinates":[[[7.5308177889760879,6.5968409249471254],[7.530680234227777,6.5968698666220584],[7.5306109784941553,6.5966311526854025],[7.5306299686674745,6.5965995113270113],[7.5307409737645825,6.5965761551787967],[7.5308177889760879,6.5968409249471254]]]},"properties":{"FID":25,"Text":"              P67","Shape_Leng":90.139427424299996,"Shape_Area":468.04218645399999}},{"type":"Feature","id":26,"geometry":{"type":"Polygon","coordinates":[[[7.5308946033363435,6.5971056947163271],[7.5307835981180817,6.5971290499694266],[7.5307494900045375,6.597108580561609],[7.530680234227777,6.5968698666220584],[7.5308177889760879,6.5968409249471254],[7.5308946033363435,6.5971056947163271]]]},"properties":{"FID":26,"Text":"              P52","Shape_Leng":90.457406823100001,"Shape_Area":468.04090849300002}},{"type":"Feature","id":27,"geometry":{"type":"Polygon","coordinates":[[[7.5310294959541837,6.5970773130639957],[7.5308946033363435,6.5971056947163271],[7.5308177889760879,6.5968409249471254],[7.5309526806143774,6.5968125432977169],[7.5310294959541837,6.5970773130639957]]]},"properties":{"FID":27,"Text":"              P51","Shape_Leng":91.457125140700001,"Shape_Area":463.38358629099997}},{"type":"Feature","id":28,"geometry":{"type":"Polygon","coordinates":[[[7.5309526806143774,6.5968125432977169],[7.5308177889760879,6.5968409249471254],[7.5307409737645825,6.5965761551787967],[7.5308758653249663,6.5965477744392853],[7.5309526806143774,6.5968125432977169]]]},"properties":{"FID":28,"Text":"              P68","Shape_Leng":91.456938655100004,"Shape_Area":463.381108385}},{"type":"Feature","id":29,"geometry":{"type":"Polygon","coordinates":[[[7.531087572242364,6.5967841625126944],[7.5309526806143774,6.5968125432977169],[7.5308758653249663,6.5965477744392853],[7.5310107577847072,6.5965193927582035],[7.531087572242364,6.5967841625126944]]]},"properties":{"FID":29,"Text":"              P69","Shape_Leng":91.457008304300004,"Shape_Area":463.38241190000002}},{"type":"Feature","id":30,"geometry":{"type":"Polygon","coordinates":[[[7.531164387660068,6.5970489313690717],[7.5310294959541837,6.5970773130639957],[7.5309526806143774,6.5968125432977169],[7.531087572242364,6.5967841625126944],[7.531164387660068,6.5970489313690717]]]},"properties":{"FID":30,"Text":"              P50","Shape_Leng":91.456938653099996,"Shape_Area":463.38110835399999}},{"type":"Feature","id":31,"geometry":{"type":"Polygon","coordinates":[[[7.5312937736123535,6.5970015707270626],[7.5312862414026194,6.5970049533059223],[7.5312792884325503,6.5970094055929458],[7.5312730651051965,6.597014831268937],[7.5312677074156769,6.5970211131728833],[7.5312633306209076,6.5970281132833328],[7.531164387660068,6.5970489313690717],[7.531087572242364,6.5967841625126944],[7.5312224638653831,6.5967557807834183],[7.5312937736123535,6.5970015707270626]]]},"properties":{"FID":31,"Text":"              P49","Shape_Leng":89.774341782700006,"Shape_Area":457.75822556600002}},{"type":"Feature","id":32,"geometry":{"type":"Polygon","coordinates":[[[7.5312224638653831,6.5967557807834183],[7.531087572242364,6.5967841625126944],[7.5310107577847072,6.5965193927582035],[7.5310921809958273,6.5965022606277266],[7.5310991295862806,6.5965088093832938],[7.5311070893613872,6.5965140824088095],[7.5311158283572226,6.5965179270951664],[7.5311250945921557,6.5965202323729972],[7.5311346169658382,6.5965209305239796],[7.5311441188134367,6.5965200008381153],[7.53115332603923,6.5965174714462114],[7.5312224638653831,6.5967557807834183]]]},"properties":{"FID":32,"Text":"              P70","Shape_Leng":89.759053076800001,"Shape_Area":449.24072702699999}},{"type":"Feature","id":33,"geometry":{"type":"Polygon","coordinates":[[[7.531357356385092,6.5967273990168449],[7.5312224638653831,6.5967557807834183],[7.53115332603923,6.5965174714462114],[7.5311609815704497,6.596513973478177],[7.5311680272299411,6.5965093668257166],[7.5311743026405349,6.5965037568219218],[7.5311796663519646,6.596497270559281],[7.5311839976601824,6.5964900532778463],[7.5311871993176451,6.5964822692774598],[7.5312805408726593,6.5964626292708726],[7.531357356385092,6.5967273990168449]]]},"properties":{"FID":33,"Text":"              P71","Shape_Leng":89.299915325399994,"Shape_Area":454.06019074}},{"type":"Feature","id":34,"geometry":{"type":"Polygon","coordinates":[[[7.5314341710462847,6.5969921687636868],[7.5313477274008491,6.5970103559582132],[7.5313398082649607,6.5970050984274877],[7.5313311135707739,6.5970012538733753],[7.531321894387812,6.5969989360753676],[7.5313124163986203,6.59699821002273],[7.531302951746528,6.5969990964120644],[7.5312937736123535,6.5970015707270626],[7.5312224638653831,6.5967557807834183],[7.531357356385092,6.5967273990168449],[7.5314341710462847,6.5969921687636868]]]},"properties":{"FID":34,"Text":"              P48","Shape_Leng":90.104131307100005,"Shape_Area":454.29506551700001}},{"type":"Feature","id":35,"geometry":{"type":"Polygon","coordinates":[[[7.5315690636335937,6.5969637869515969],[7.5314341710462847,6.5969921687636868],[7.531357356385092,6.5967273990168449],[7.5314922479928548,6.5966990172076851],[7.5315690636335937,6.5969637869515969]]]},"properties":{"FID":35,"Text":"              P47","Shape_Leng":91.4571251399,"Shape_Area":463.38358627500003}},{"type":"Feature","id":36,"geometry":{"type":"Polygon","coordinates":[[[7.5314922479928548,6.5966990172076851],[7.531357356385092,6.5967273990168449],[7.5312805408726593,6.5964626292708726],[7.5314154324025218,6.5964342483716143],[7.5314922479928548,6.5966990172076851]]]},"properties":{"FID":36,"Text":"              P72","Shape_Leng":91.456938654300004,"Shape_Area":463.381108369}},{"type":"Feature","id":37,"geometry":{"type":"Polygon","coordinates":[[[7.5316271395929748,6.596670635358584],[7.5314922479928548,6.5966990172076851],[7.5314154324025218,6.5964342483716143],[7.5315503248317359,6.5964058665307688],[7.5316271395929748,6.596670635358584]]]},"properties":{"FID":37,"Text":"              P73","Shape_Leng":91.456933224699995,"Shape_Area":463.38209556999999}},{"type":"Feature","id":38,"geometry":{"type":"Polygon","coordinates":[[[7.5317039553089433,6.5969354050969011],[7.5315690636335937,6.5969637869515969],[7.5314922479928548,6.5966990172076851],[7.5316271395929748,6.596670635358584],[7.5317039553089433,6.5969354050969011]]]},"properties":{"FID":38,"Text":"              P46","Shape_Leng":91.457055487999995,"Shape_Area":463.38228271700001}},{"type":"Feature","id":39,"geometry":{"type":"Polygon","coordinates":[[[7.531825535077874,6.596909824476608],[7.5317039553089433,6.5969354050969011],[7.5316271395929748,6.596670635358584],[7.5317487201984212,6.5966450547459976],[7.531825535077874,6.596909824476608]]]},"properties":{"FID":39,"Text":"              P45","Shape_Leng":88.448607884799998,"Shape_Area":417.65396871000002}},{"type":"Feature","id":40,"geometry":{"type":"Polygon","coordinates":[[[7.5317487201984212,6.5966450547459976],[7.5316271395929748,6.596670635358584],[7.5315503248317359,6.5964058665307688],[7.5316719044650569,6.5963802859205636],[7.5317487201984212,6.5966450547459976]]]},"properties":{"FID":40,"Text":"              P74","Shape_Leng":88.448415970799999,"Shape_Area":417.65262512999999}},{"type":"Feature","id":41,"geometry":{"type":"Polygon","coordinates":[[[7.5312820041367567,6.5979963551428726],[7.531147112162115,6.598024736813259],[7.5310702976256154,6.5977599670312754],[7.5312051895223568,6.5977315862707924],[7.5312820041367567,6.5979963551428726]]]},"properties":{"FID":41,"Text":"              P11","Shape_Leng":91.456882363299997,"Shape_Area":463.38079013499998}},{"type":"Feature","id":42,"geometry":{"type":"Polygon","coordinates":[[[7.5314168970080901,6.5979679734351979],[7.5312820041367567,6.5979963551428726],[7.5312051895223568,6.5977315862707924],[7.5313400814141218,6.5977032045660504],[7.5314168970080901,6.5979679734351979]]]},"properties":{"FID":42,"Text":"              P12","Shape_Leng":91.4569332242,"Shape_Area":463.38209556700002}},{"type":"Feature","id":43,"geometry":{"type":"Polygon","coordinates":[[[7.5315517889648058,6.5979395925892064],[7.5314168970080901,6.5979679734351979],[7.5313400814141218,6.5977032045660504],[7.5314749732982511,6.597674822821344],[7.5315517889648058,6.5979395925892064]]]},"properties":{"FID":43,"Text":"              P13","Shape_Leng":91.456938655100004,"Shape_Area":463.381108385}},{"type":"Feature","id":44,"geometry":{"type":"Polygon","coordinates":[[[7.5316866809165397,6.5979112107989737],[7.5315517889648058,6.5979395925892064],[7.5314749732982511,6.597674822821344],[7.531571684011622,6.5976544747009154],[7.5315778322398463,6.5976604251500506],[7.5315848154161689,6.5976653706455188],[7.5315924702010095,6.5976691940488683],[7.5316006177959647,6.5976718071144083],[7.5316090693751079,6.5976731486965141],[7.5316176251700009,6.5976731883642143],[7.5316866809165397,6.5979112107989737]]]},"properties":{"FID":44,"Text":"              P14","Shape_Leng":89.739948061199996,"Shape_Area":454.45878492700001}},{"type":"Feature","id":45,"geometry":{"type":"Polygon","coordinates":[[[7.531821572860637,6.5978828289687925],[7.5316866809165397,6.5979112107989737],[7.5316176251700009,6.5976731883642143],[7.5316270083930617,6.5976717057847134],[7.5316360055519187,6.5976686584982245],[7.5316443586496193,6.5976641352726269],[7.5316518267489272,6.5976582665248031],[7.5316581968375633,6.5976512198310173],[7.5316632838335735,6.5976431981182655],[7.5316669432671421,6.5976344324671459],[7.5317447579479362,6.5976180592147902],[7.531821572860637,6.5978828289687925]]]},"properties":{"FID":45,"Text":"              P15","Shape_Leng":89.280366159600007,"Shape_Area":448.588102306}},{"type":"Feature","id":46,"geometry":{"type":"Polygon","coordinates":[[[7.5319564657014215,6.5978544471013105],[7.531821572860637,6.5978828289687925],[7.5317447579479362,6.5976180592147902],[7.531879649806493,6.5975896782545567],[7.5319564657014215,6.5978544471013105]]]},"properties":{"FID":46,"Text":"              P16","Shape_Leng":91.457008304599995,"Shape_Area":463.382411913}},{"type":"Feature","id":47,"geometry":{"type":"Polygon","coordinates":[[[7.5320913576275883,6.597826066095549],[7.5319564657014215,6.5978544471013105],[7.531879649806493,6.5975896782545567],[7.5320145416600761,6.5975612963500847],[7.5320913576275883,6.597826066095549]]]},"properties":{"FID":47,"Text":"              P17","Shape_Leng":91.456938654300004,"Shape_Area":463.381108369}},{"type":"Feature","id":48,"geometry":{"type":"Polygon","coordinates":[[[7.5310659213340942,6.5976961995733365],[7.530954915070744,6.5977195557383403],[7.530920807816857,6.5976990863348632],[7.5308515519333827,6.5974603723882019],[7.5309891059484837,6.5974314306978972],[7.5310659213340942,6.5976961995733365]]]},"properties":{"FID":48,"Text":"              P25","Shape_Leng":90.457273994600001,"Shape_Area":468.03940542599997}},{"type":"Feature","id":49,"geometry":{"type":"Polygon","coordinates":[[[7.5309891059484837,6.5974314306978972],[7.5308515519333827,6.5974603723882019],[7.5307822960957225,6.5972216575401212],[7.5308012853834301,6.5971900170801474],[7.5309122915229452,6.5971666609243442],[7.5309891059484837,6.5974314306978972]]]},"properties":{"FID":49,"Text":"P37","Shape_Leng":90.139358135099997,"Shape_Area":468.04058540599999}},{"type":"Feature","id":50,"geometry":{"type":"Polygon","coordinates":[[[7.531147112162115,6.598024736813259],[7.5310228699056463,6.5980508772676387],[7.5309536139585935,6.5978121633167444],[7.530972603270345,6.5977805219492298],[7.5310702976256154,6.5977599670312754],[7.531147112162115,6.598024736813259]]]},"properties":{"FID":50,"Text":"              P10","Shape_Leng":87.130830820499995,"Shape_Area":422.31134421799999}}]}
;

        // Global variables
        let map;
        let currentLayer = 'satellite';
        let subdivisionLayer;
        let parcelData = {};
        let userLocationMarker;
        let plotLabels = [];
        let labelsVisible = false;
        
        // Color scheme for parcel status
        const statusColors = {
            available: '#28a745',
            reserved: '#ffc107',
            sold: '#dc3545',
            unavailable: '#6c757d'
        };
        
        // Initialize the map
        function initMap() {
            map = L.map('map', {
                zoomControl: true,
                attributionControl: true
            }).setView([6.596, 7.531], 17);
            
            // Add tile layers
            const mapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors',
                maxZoom: 20
            });
            
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles  Esri  Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                maxZoom: 20
            });
            
            // Start with satellite view
            satelliteLayer.addTo(map);
            
            // Load subdivision data
            loadSubdivisionData();
        }
        
        // Load and display subdivision data
        function loadSubdivisionData() {
            try {
                // Load saved parcel statuses
                const savedStatuses = JSON.parse(localStorage.getItem('parcelStatuses') || '{}');
                
                subdivisionLayer = L.geoJSON(subdivisionData, {
                    style: function(feature) {
                        const parcelId = feature.properties.plot_no || feature.properties.id || 'Unknown';
                        const status = savedStatuses[parcelId] || 'available';
                        parcelData[parcelId] = {
                            feature: feature,
                            status: status
                        };
                        
                        return {
                            color: '#ffffff',
                            weight: 3,
                            opacity: 1,
                            fillColor: statusColors[status],
                            fillOpacity: 0.7
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        const parcelId = feature.properties.plot_no || feature.properties.id || 'Unknown';
                        const area = feature.properties.area || feature.properties.AREA || 'N/A';
                        const status = parcelData[parcelId]?.status || 'available';
                        
                        // Create popup content
                        const popupContent = `
                            <div class="parcel-popup">
                                <h3> Plot ${parcelId}</h3>
                                <p><strong>Area:</strong> ${area} sq meters</p>
                                <p><strong>Status:</strong> <span class="status-badge status-${status}">${status.toUpperCase()}</span></p>
                                <p><strong>Coordinates:</strong> ${layer.getBounds().getCenter().lat.toFixed(6)}, ${layer.getBounds().getCenter().lng.toFixed(6)}</p>
                            </div>
                        `;
                        
                        layer.bindPopup(popupContent);
                        
                        // Store layer reference
                        parcelData[parcelId].layer = layer;
                        
                        // Add hover effects
                        layer.on({
                            mouseover: function(e) {
                                const layer = e.target;
                                layer.setStyle({
                                    weight: 5,
                                    color: '#ffffff',
                                    dashArray: '',
                                    fillOpacity: 0.9
                                });
                                layer.bringToFront();
                            },
                            mouseout: function(e) {
                                subdivisionLayer.resetStyle(e.target);
                            }
                        });
                    }
                }).addTo(map);
                
                // Populate admin dropdown
                populateParcelDropdown();
                
                // Fit map to subdivision bounds
                map.fitBounds(subdivisionLayer.getBounds(), { padding: [20, 20] });
                
                // Hide loading screen
                document.getElementById('loading').style.display = 'none';
                
                console.log(`Loaded ${Object.keys(parcelData).length} parcels successfully`);
                
            } catch (error) {
                console.error('Error loading subdivision data:', error);
                document.getElementById('loading').innerHTML = '<h3> Error loading data</h3><p>Please check the console for details.</p>';
            }
        }
        
        // Toggle between map and satellite view
        function toggleLayer(layerType) {
            const mapBtn = document.getElementById('mapBtn');
            const satelliteBtn = document.getElementById('satelliteBtn');
            
            // Remove existing layers
            map.eachLayer(function(layer) {
                if (layer._url && layer._url.includes('tile')) {
                    map.removeLayer(layer);
                }
            });
            
            if (layerType === 'map') {
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ' OpenStreetMap contributors',
                    maxZoom: 20
                }).addTo(map);
                mapBtn.classList.add('active');
                satelliteBtn.classList.remove('active');
                currentLayer = 'map';
            } else {
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles  Esri',
                    maxZoom: 20
                }).addTo(map);
                satelliteBtn.classList.add('active');
                mapBtn.classList.remove('active');
                currentLayer = 'satellite';
            }
        }
        
        // Toggle plot number labels
        function toggleLabels() {
            const btn = document.getElementById('labelsBtn');
            
            if (labelsVisible) {
                // Hide labels
                plotLabels.forEach(label => map.removeLayer(label));
                plotLabels = [];
                btn.textContent = ' Show Plot Numbers';
                btn.classList.remove('active');
                labelsVisible = false;
            } else {
                // Show labels
                Object.keys(parcelData).forEach(parcelId => {
                    const parcel = parcelData[parcelId];
                    if (parcel.layer) {
                        const bounds = parcel.layer.getBounds();
                        const center = bounds.getCenter();
                        
                        const label = L.marker(center, {
                            icon: L.divIcon({
                                className: 'plot-label',
                                html: `Plot ${parcelId}`,
                                iconSize: [60, 25],
                                iconAnchor: [30, 12]
                            })
                        }).addTo(map);
                        
                        plotLabels.push(label);
                    }
                });
                
                btn.textContent = ' Hide Plot Numbers';
                btn.classList.add('active');
                labelsVisible = true;
            }
        }
        
        // Locate user's current position
        function locateUser() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Remove existing user location marker
                    if (userLocationMarker) {
                        map.removeLayer(userLocationMarker);
                    }
                    
                    // Add new marker
                    userLocationMarker = L.marker([lat, lng], {
                        icon: L.divIcon({
                            className: 'user-location',
                            html: '',
                            iconSize: [30, 30],
                            iconAnchor: [15, 15]
                        })
                    }).addTo(map);
                    
                    userLocationMarker.bindPopup('<strong> Your Current Location</strong>').openPopup();
                    
                    // Center map on user location
                    map.setView([lat, lng], 16);
                    
                }, function(error) {
                    alert('Unable to get your location: ' + error.message);
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
        
        // Zoom to subdivision
        function zoomToSubdivision() {
            if (subdivisionLayer) {
                map.fitBounds(subdivisionLayer.getBounds(), { padding: [20, 20] });
            }
        }
        
        // Populate parcel dropdown for admin panel
        function populateParcelDropdown() {
            const select = document.getElementById('parcelSelect');
            select.innerHTML = '<option value="">Select Parcel...</option>';
            
            const sortedParcels = Object.keys(parcelData).sort((a, b) => {
                const numA = parseInt(a.replace(/\D/g, '')) || 0;
                const numB = parseInt(b.replace(/\D/g, '')) || 0;
                return numA - numB;
            });
            
            sortedParcels.forEach(parcelId => {
                const option = document.createElement('option');
                option.value = parcelId;
                option.textContent = `Plot ${parcelId} (${parcelData[parcelId].status})`;
                select.appendChild(option);
            });
        }
        
        // Select parcel for status update
        function selectParcel() {
            const select = document.getElementById('parcelSelect');
            const statusSelect = document.getElementById('statusSelect');
            const parcelId = select.value;
            
            if (parcelId && parcelData[parcelId]) {
                statusSelect.value = parcelData[parcelId].status;
                
                // Highlight selected parcel
                const layer = parcelData[parcelId].layer;
                if (layer) {
                    map.setView(layer.getBounds().getCenter(), 19);
                    layer.openPopup();
                }
            }
        }
        
        // Update parcel status
        function updateParcelStatus() {
            const parcelSelect = document.getElementById('parcelSelect');
            const statusSelect = document.getElementById('statusSelect');
            const parcelId = parcelSelect.value;
            const newStatus = statusSelect.value;
            
            if (parcelId && parcelData[parcelId]) {
                // Update in memory
                parcelData[parcelId].status = newStatus;
                
                // Update layer style
                const layer = parcelData[parcelId].layer;
                layer.setStyle({
                    fillColor: statusColors[newStatus]
                });
                
                // Update popup content
                const feature = parcelData[parcelId].feature;
                const area = feature.properties.area || feature.properties.AREA || 'N/A';
                const popupContent = `
                    <div class="parcel-popup">
                        <h3> Plot ${parcelId}</h3>
                        <p><strong>Area:</strong> ${area} sq meters</p>
                        <p><strong>Status:</strong> <span class="status-badge status-${newStatus}">${newStatus.toUpperCase()}</span></p>
                        <p><strong>Coordinates:</strong> ${layer.getBounds().getCenter().lat.toFixed(6)}, ${layer.getBounds().getCenter().lng.toFixed(6)}</p>
                    </div>
                `;
                layer.setPopupContent(popupContent);
                
                // Save to localStorage
                const savedStatuses = JSON.parse(localStorage.getItem('parcelStatuses') || '{}');
                savedStatuses[parcelId] = newStatus;
                localStorage.setItem('parcelStatuses', JSON.stringify(savedStatuses));
                
                // Update dropdown
                populateParcelDropdown();
                parcelSelect.value = parcelId; // Keep selection
                
                // Show success message
                layer.openPopup();
                
                console.log(`Updated Plot ${parcelId} to ${newStatus}`);
            }
        }
        
        // Initialize map when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (map) {
                map.invalidateSize();
            }
        });
    </script>
</body>
</html>
