<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coral Subdivision Mapper</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1000;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        select {
            padding: 8px 15px;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            background: white;
            font-size: 14px;
            min-width: 120px;
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        #map {
            height: calc(100vh - 140px);
            width: 100%;
        }
        
        .legend {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 200px;
        }
        
        .legend h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
            border: 2px solid rgba(0,0,0,0.2);
        }
        
        .parcel-popup {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .parcel-popup h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .parcel-popup p {
            margin-bottom: 5px;
            color: #555;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: 10px;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-reserved {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-sold {
            background: #f8d7da;
            color: #721c24;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 2000;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .mobile-controls {
            display: none;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .legend {
                position: relative;
                top: auto;
                right: auto;
                margin: 10px;
                order: -1;
            }
            
            .mobile-controls {
                display: block;
            }
            
            .desktop-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1> Coral Subdivision</h1>
        <p>Interactive Real Estate Parcel Viewer</p>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading subdivision data...</p>
    </div>
    
    <div id="map"></div>
    
    <div class="legend">
        <h4> Parcel Status</h4>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #28a745;"></div>
            <span>Available</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ffc107;"></div>
            <span>Reserved</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #dc3545;"></div>
            <span>Sold</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #6c757d;"></div>
            <span>Not Available</span>
        </div>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <button class="btn" id="mapBtn" onclick="toggleLayer('map')"> Map View</button>
            <button class="btn active" id="satelliteBtn" onclick="toggleLayer('satellite')"> Satellite</button>
        </div>
        
        <div class="control-group">
            <button class="btn" onclick="locateUser()"> My Location</button>
            <button class="btn" onclick="zoomToSubdivision()"> Zoom to Subdivision</button>
        </div>
        
        <div class="control-group admin-panel" style="margin-left: auto;">
            <label for="parcelSelect" style="color: #2c3e50; font-weight: 600;">Admin Panel:</label>
            <select id="parcelSelect" onchange="selectParcel()">
                <option value="">Select Parcel...</option>
            </select>
            <select id="statusSelect" onchange="updateParcelStatus()">
                <option value="available">Available</option>
                <option value="reserved">Reserved</option>
                <option value="sold">Sold</option>
            </select>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <script>
        // Embedded GeoJSON data
        const subdivisionData = {
"type": "FeatureCollection",
"name": "Coral_Parcels",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::32632" } },
"features": [
{ "type": "Feature", "properties": { "Text": "P80", "Shape_Leng": 82.521059743500004, "Shape_Area": 448.61074333800002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337567.95409999974072, 729383.852800000458956, 0.0 ], [ 337561.349499999545515, 729361.335500000044703, 0.0 ], [ 337545.159400000236928, 729364.791799999773502, 0.0 ], [ 337543.069899999536574, 729368.296900000423193, 0.0 ], [ 337547.985799999907613, 729385.056800000369549, 0.0 ], [ 337551.764000000432134, 729387.309200000017881, 0.0 ], [ 337567.95409999974072, 729383.852800000458956, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P79", "Shape_Leng": 87.044595452400003, "Shape_Area": 469.31820235700002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337587.568500000052154, 729379.665500000119209, 0.0 ], [ 337580.963899999856949, 729357.148199999704957, 0.0 ], [ 337569.105499999597669, 729359.679800000041723, 0.0 ], [ 337561.349499999545515, 729361.335500000044703, 0.0 ], [ 337567.95409999974072, 729383.852800000458956, 0.0 ], [ 337587.568500000052154, 729379.665500000119209, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P78", "Shape_Leng": 85.483440563399995, "Shape_Area": 465.136302355 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337606.598199999891222, 729373.4847999997437, 0.0 ], [ 337600.578300000168383, 729352.960799999535084, 0.0 ], [ 337580.963899999856949, 729357.148199999704957, 0.0 ], [ 337587.568500000052154, 729379.665500000119209, 0.0 ], [ 337603.908599999733269, 729376.17710000090301, 0.0 ], [ 337604.414200000464916, 729375.353900000452995, 0.0 ], [ 337605.041600000113249, 729374.619300000369549, 0.0 ], [ 337605.775500000454485, 729373.991200000047684, 0.0 ], [ 337606.598199999891222, 729373.4847999997437, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P77", "Shape_Leng": 85.828190343900005, "Shape_Area": 458.36764058199998 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337626.7972999997437, 729371.29079999960959, 0.0 ], [ 337620.192599999718368, 729348.773499999195337, 0.0 ], [ 337600.578300000168383, 729352.960799999535084, 0.0 ], [ 337606.598199999891222, 729373.4847999997437, 0.0 ], [ 337607.538800000213087, 729373.096599999815226, 0.0 ], [ 337608.530299999751151, 729372.867599999532104, 0.0 ], [ 337609.545800000429153, 729372.803899999707937, 0.0 ], [ 337610.558100000023842, 729372.907400000840425, 0.0 ], [ 337611.539800000376999, 729373.175300000235438, 0.0 ], [ 337612.464399999938905, 729373.600199999287724, 0.0 ], [ 337613.306900000199676, 729374.170800000429153, 0.0 ], [ 337626.7972999997437, 729371.29079999960959, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P76", "Shape_Leng": 87.044525799400006, "Shape_Area": 469.317854195 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337646.411600000225008, 729367.103499999269843, 0.0 ], [ 337639.807000000029802, 729344.586200000718236, 0.0 ], [ 337620.192599999718368, 729348.773499999195337, 0.0 ], [ 337626.7972999997437, 729371.29079999960959, 0.0 ], [ 337646.411600000225008, 729367.103499999269843, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P75", "Shape_Leng": 87.248485529099995, "Shape_Area": 485.952603802 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337666.908699999563396, 729362.727700000628829, 0.0 ], [ 337661.148400000296533, 729343.089099999517202, 0.0 ], [ 337657.370199999772012, 729340.83669999986887, 0.0 ], [ 337648.331000000238419, 729342.766400000080466, 0.0 ], [ 337639.807000000029802, 729344.586200000718236, 0.0 ], [ 337646.411600000225008, 729367.103499999269843, 0.0 ], [ 337666.908699999563396, 729362.727700000628829, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P100", "Shape_Leng": 87.936343113800007, "Shape_Area": 454.407160025 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337654.5477, 729331.213899999856949, 0.0 ], [ 337656.637199999764562, 729327.70890000090003, 0.0 ], [ 337653.191399999894202, 729315.960999999195337, 0.0 ], [ 337623.377500000409782, 729322.325699999928474, 0.0 ], [ 337626.823300000280142, 729334.073599999770522, 0.0 ], [ 337630.601599999703467, 729336.325999999418855, 0.0 ], [ 337654.5477, 729331.213899999856949, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P101", "Shape_Leng": 91.457023561599996, "Shape_Area": 463.38182565800003 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337653.191399999894202, 729315.960999999195337, 0.0 ], [ 337648.901200000196695, 729301.334400000050664, 0.0 ], [ 337619.087299999780953, 729307.699100000783801, 0.0 ], [ 337623.377500000409782, 729322.325699999928474, 0.0 ], [ 337653.191399999894202, 729315.960999999195337, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P115", "Shape_Leng": 91.457014458700002, "Shape_Area": 463.38248134700001 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337648.901200000196695, 729301.334400000050664, 0.0 ], [ 337644.610999999567866, 729286.707699999213219, 0.0 ], [ 337614.797199999913573, 729293.072499999776483, 0.0 ], [ 337619.087299999780953, 729307.699100000783801, 0.0 ], [ 337648.901200000196695, 729301.334400000050664, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P116", "Shape_Leng": 91.456944803100001, "Shape_Area": 463.38206818800001 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337644.610999999567866, 729286.707699999213219, 0.0 ], [ 337640.32079999987036, 729272.081100000068545, 0.0 ], [ 337610.507000000216067, 729278.445800000801682, 0.0 ], [ 337614.797199999913573, 729293.072499999776483, 0.0 ], [ 337644.610999999567866, 729286.707699999213219, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P130", "Shape_Leng": 91.456897621400003, "Shape_Area": 463.38077611900002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337640.32079999987036, 729272.081100000068545, 0.0 ], [ 337636.0307, 729257.454500000923872, 0.0 ], [ 337606.216799999587238, 729263.819199999794364, 0.0 ], [ 337610.507000000216067, 729278.445800000801682, 0.0 ], [ 337640.32079999987036, 729272.081100000068545, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P24", "Shape_Leng": 91.457008305000002, "Shape_Area": 463.38241191200001 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337617.211099999956787, 729511.992900000885129, 0.0 ], [ 337608.630800000391901, 729482.73960000090301, 0.0 ], [ 337593.723799999803305, 729485.92200000025332, 0.0 ], [ 337602.30420000012964, 729515.175200000405312, 0.0 ], [ 337617.211099999956787, 729511.992900000885129, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P38", "Shape_Leng": 91.4571251399, "Shape_Area": 463.38358627500003 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337608.630800000391901, 729482.73960000090301, 0.0 ], [ 337600.050400000065565, 729453.486300000920892, 0.0 ], [ 337585.143500000238419, 729456.668700000271201, 0.0 ], [ 337593.723799999803305, 729485.92200000025332, 0.0 ], [ 337608.630800000391901, 729482.73960000090301, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P39", "Shape_Leng": 91.456938654400005, "Shape_Area": 463.38110837300002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337623.537700000219047, 729479.557199999690056, 0.0 ], [ 337614.957299999892712, 729450.303999999538064, 0.0 ], [ 337600.050400000065565, 729453.486300000920892, 0.0 ], [ 337608.630800000391901, 729482.73960000090301, 0.0 ], [ 337623.537700000219047, 729479.557199999690056, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P23", "Shape_Leng": 91.456999197900004, "Shape_Area": 463.38196449399999 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337632.117999999783933, 729508.810499999672174, 0.0 ], [ 337623.537700000219047, 729479.557199999690056, 0.0 ], [ 337608.630800000391901, 729482.73960000090301, 0.0 ], [ 337617.211099999956787, 729511.992900000885129, 0.0 ], [ 337632.117999999783933, 729508.810499999672174, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P22", "Shape_Leng": 91.4571251399, "Shape_Area": 463.38358627500003 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337647.025000000372529, 729505.628100000321865, 0.0 ], [ 337638.444600000046194, 729476.374800000339746, 0.0 ], [ 337623.537700000219047, 729479.557199999690056, 0.0 ], [ 337632.117999999783933, 729508.810499999672174, 0.0 ], [ 337647.025000000372529, 729505.628100000321865, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P40", "Shape_Leng": 89.681916383100003, "Shape_Area": 451.596033073 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337638.444600000046194, 729476.374800000339746, 0.0 ], [ 337630.752899999730289, 729450.151200000196695, 0.0 ], [ 337629.820299999788404, 729450.285700000822544, 0.0 ], [ 337628.877999999560416, 729450.277300000190735, 0.0 ], [ 337627.947999999858439, 729450.126000000163913, 0.0 ], [ 337627.051599999889731, 729449.835400000214577, 0.0 ], [ 337626.209699999541044, 729449.412200000137091, 0.0 ], [ 337625.441800000146031, 729448.866200000047684, 0.0 ], [ 337624.76549999974668, 729448.210100000724196, 0.0 ], [ 337614.957299999892712, 729450.303999999538064, 0.0 ], [ 337623.537700000219047, 729479.557199999690056, 0.0 ], [ 337638.444600000046194, 729476.374800000339746, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P41", "Shape_Leng": 89.209179138500005, "Shape_Area": 451.20072944600003 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337653.35149999987334, 729473.192500000819564, 0.0 ], [ 337644.771200000308454, 729443.939200000837445, 0.0 ], [ 337635.315700000151992, 729445.957800000905991, 0.0 ], [ 337634.973399999551475, 729446.818499999120831, 0.0 ], [ 337634.50650000013411, 729447.61849999986589, 0.0 ], [ 337633.925599999725819, 729448.339900000020862, 0.0 ], [ 337633.243599999696016, 729448.966700000688434, 0.0 ], [ 337632.47580000013113, 729449.4847999997437, 0.0 ], [ 337631.639299999922514, 729449.88260000012815, 0.0 ], [ 337630.752899999730289, 729450.151200000196695, 0.0 ], [ 337638.444600000046194, 729476.374800000339746, 0.0 ], [ 337653.35149999987334, 729473.192500000819564, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P21", "Shape_Leng": 91.456938652299996, "Shape_Area": 463.38110835100002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337661.931900000199676, 729502.445699999108911, 0.0 ], [ 337653.35149999987334, 729473.192500000819564, 0.0 ], [ 337638.444600000046194, 729476.374800000339746, 0.0 ], [ 337647.025000000372529, 729505.628100000321865, 0.0 ], [ 337661.931900000199676, 729502.445699999108911, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P20", "Shape_Leng": 91.457008303600006, "Shape_Area": 463.38241190600002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337676.838800000026822, 729499.263399999588728, 0.0 ], [ 337668.258500000461936, 729470.010099999606609, 0.0 ], [ 337653.35149999987334, 729473.192500000819564, 0.0 ], [ 337661.931900000199676, 729502.445699999108911, 0.0 ], [ 337676.838800000026822, 729499.263399999588728, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P42", "Shape_Leng": 91.457125140700001, "Shape_Area": 463.38358629099997 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337668.258500000461936, 729470.010099999606609, 0.0 ], [ 337659.678100000135601, 729440.756799999624491, 0.0 ], [ 337644.771200000308454, 729443.939200000837445, 0.0 ], [ 337653.35149999987334, 729473.192500000819564, 0.0 ], [ 337668.258500000461936, 729470.010099999606609, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P43", "Shape_Leng": 91.456938653700007, "Shape_Area": 463.38110835700002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337683.165400000289083, 729466.8277000002563, 0.0 ], [ 337674.584999999962747, 729437.574500000104308, 0.0 ], [ 337659.678100000135601, 729440.756799999624491, 0.0 ], [ 337668.258500000461936, 729470.010099999606609, 0.0 ], [ 337683.165400000289083, 729466.8277000002563, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P19", "Shape_Leng": 91.456999197200005, "Shape_Area": 463.38196447799999 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337691.745699999853969, 729496.081000000238419, 0.0 ], [ 337683.165400000289083, 729466.8277000002563, 0.0 ], [ 337668.258500000461936, 729470.010099999606609, 0.0 ], [ 337676.838800000026822, 729499.263399999588728, 0.0 ], [ 337691.745699999853969, 729496.081000000238419, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P18", "Shape_Leng": 88.448532805499994, "Shape_Area": 417.653725936 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337705.181599999777973, 729493.212600000202656, 0.0 ], [ 337696.60120000038296, 729463.959400000050664, 0.0 ], [ 337683.165400000289083, 729466.8277000002563, 0.0 ], [ 337691.745699999853969, 729496.081000000238419, 0.0 ], [ 337705.181599999777973, 729493.212600000202656, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P44", "Shape_Leng": 88.448532806100005, "Shape_Area": 417.65372593799998 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337696.60120000038296, 729463.959400000050664, 0.0 ], [ 337688.020899999886751, 729434.706100000068545, 0.0 ], [ 337674.584999999962747, 729437.574500000104308, 0.0 ], [ 337683.165400000289083, 729466.8277000002563, 0.0 ], [ 337696.60120000038296, 729463.959400000050664, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P67", "Shape_Leng": 90.139427424299996, "Shape_Area": 468.04218645399999 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337574.58739999961108, 729420.679500000551343, 0.0 ], [ 337566.007000000216067, 729391.426200000569224, 0.0 ], [ 337553.739799999631941, 729394.045099999755621, 0.0 ], [ 337551.650200000032783, 729397.550200000405312, 0.0 ], [ 337559.386199999600649, 729423.924699999392033, 0.0 ], [ 337574.58739999961108, 729420.679500000551343, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P52", "Shape_Leng": 90.457406823100001, "Shape_Area": 468.04090849300002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337583.167700000107288, 729449.932800000533462, 0.0 ], [ 337574.58739999961108, 729420.679500000551343, 0.0 ], [ 337559.386199999600649, 729423.924699999392033, 0.0 ], [ 337567.122200000099838, 729450.299200000241399, 0.0 ], [ 337570.900500000454485, 729452.551599999889731, 0.0 ], [ 337583.167700000107288, 729449.932800000533462, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P51", "Shape_Leng": 91.457125140700001, "Shape_Area": 463.38358629099997 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337598.074699999764562, 729446.750399999320507, 0.0 ], [ 337589.494300000369549, 729417.497099999338388, 0.0 ], [ 337574.58739999961108, 729420.679500000551343, 0.0 ], [ 337583.167700000107288, 729449.932800000533462, 0.0 ], [ 337598.074699999764562, 729446.750399999320507, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P68", "Shape_Leng": 91.456938655100004, "Shape_Area": 463.381108385 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337589.494300000369549, 729417.497099999338388, 0.0 ], [ 337580.913900000043213, 729388.243899999186397, 0.0 ], [ 337566.007000000216067, 729391.426200000569224, 0.0 ], [ 337574.58739999961108, 729420.679500000551343, 0.0 ], [ 337589.494300000369549, 729417.497099999338388, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P69", "Shape_Leng": 91.457008304300004, "Shape_Area": 463.3824119 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337604.401200000196695, 729414.314799999818206, 0.0 ], [ 337595.820899999700487, 729385.061499999836087, 0.0 ], [ 337580.913900000043213, 729388.243899999186397, 0.0 ], [ 337589.494300000369549, 729417.497099999338388, 0.0 ], [ 337604.401200000196695, 729414.314799999818206, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P50", "Shape_Leng": 91.456938653099996, "Shape_Area": 463.38110835399999 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337612.981599999591708, 729443.567999999970198, 0.0 ], [ 337604.401200000196695, 729414.314799999818206, 0.0 ], [ 337589.494300000369549, 729417.497099999338388, 0.0 ], [ 337598.074699999764562, 729446.750399999320507, 0.0 ], [ 337612.981599999591708, 729443.567999999970198, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P49", "Shape_Leng": 89.774341782700006, "Shape_Area": 457.75822556600002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337627.27350000012666, 729438.288699999451637, 0.0 ], [ 337619.308100000023842, 729411.132400000467896, 0.0 ], [ 337604.401200000196695, 729414.314799999818206, 0.0 ], [ 337612.981599999591708, 729443.567999999970198, 0.0 ], [ 337623.91579999960959, 729441.23369999974966, 0.0 ], [ 337624.397499999962747, 729440.458200000226498, 0.0 ], [ 337624.987900000065565, 729439.761800000444055, 0.0 ], [ 337625.674300000071526, 729439.159800000488758, 0.0 ], [ 337626.441700000315905, 729438.665200000628829, 0.0 ], [ 337627.27350000012666, 729438.288699999451637, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P70", "Shape_Leng": 89.759053076800001, "Shape_Area": 449.24072702699999 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337619.308100000023842, 729411.132400000467896, 0.0 ], [ 337611.58530000038445, 729384.802600000053644, 0.0 ], [ 337610.567999999970198, 729385.08530000038445, 0.0 ], [ 337609.517599999904633, 729385.191199999302626, 0.0 ], [ 337608.464399999938905, 729385.11710000038147, 0.0 ], [ 337607.439000000245869, 729384.865199999883771, 0.0 ], [ 337606.471400000154972, 729384.442900000140071, 0.0 ], [ 337605.589499999769032, 729383.862400000914931, 0.0 ], [ 337604.81900000013411, 729383.14049999974668, 0.0 ], [ 337595.820899999700487, 729385.061499999836087, 0.0 ], [ 337604.401200000196695, 729414.314799999818206, 0.0 ], [ 337619.308100000023842, 729411.132400000467896, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P71", "Shape_Leng": 89.299915325399994, "Shape_Area": 454.06019074 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337634.215099999681115, 729407.949999999254942, 0.0 ], [ 337625.634700000286102, 729378.696699999272823, 0.0 ], [ 337615.319500000216067, 729380.898900000378489, 0.0 ], [ 337614.968000000342727, 729381.760700000450015, 0.0 ], [ 337614.491399999707937, 729382.560200000181794, 0.0 ], [ 337613.900399999693036, 729383.279200000688434, 0.0 ], [ 337613.208300000056624, 729383.901599999517202, 0.0 ], [ 337612.430700000375509, 729384.41330000013113, 0.0 ], [ 337611.58530000038445, 729384.802600000053644, 0.0 ], [ 337619.308100000023842, 729411.132400000467896, 0.0 ], [ 337634.215099999681115, 729407.949999999254942, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P48", "Shape_Leng": 90.104131307100005, "Shape_Area": 454.29506551700001 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337642.795400000177324, 729437.203299999237061, 0.0 ], [ 337634.215099999681115, 729407.949999999254942, 0.0 ], [ 337619.308100000023842, 729411.132400000467896, 0.0 ], [ 337627.27350000012666, 729438.288699999451637, 0.0 ], [ 337628.28760000038892, 729438.012099999934435, 0.0 ], [ 337629.333899999968708, 729437.911000000312924, 0.0 ], [ 337630.38219999987632, 729437.988199999555945, 0.0 ], [ 337631.402400000020862, 729438.241499999538064, 0.0 ], [ 337632.365100000053644, 729438.663799999281764, 0.0 ], [ 337633.242499999701977, 729439.242599999532104, 0.0 ], [ 337642.795400000177324, 729437.203299999237061, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P47", "Shape_Leng": 91.4571251399, "Shape_Area": 463.38358627500003 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337657.702399999834597, 729434.020899999886751, 0.0 ], [ 337649.122000000439584, 729404.767599999904633, 0.0 ], [ 337634.215099999681115, 729407.949999999254942, 0.0 ], [ 337642.795400000177324, 729437.203299999237061, 0.0 ], [ 337657.702399999834597, 729434.020899999886751, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P72", "Shape_Leng": 91.456938654300004, "Shape_Area": 463.381108369 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337649.122000000439584, 729404.767599999904633, 0.0 ], [ 337640.541600000113249, 729375.514399999752641, 0.0 ], [ 337625.634700000286102, 729378.696699999272823, 0.0 ], [ 337634.215099999681115, 729407.949999999254942, 0.0 ], [ 337649.122000000439584, 729404.767599999904633, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P73", "Shape_Leng": 91.456933224699995, "Shape_Area": 463.38209557 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337664.028900000266731, 729401.585200000554323, 0.0 ], [ 337655.448599999770522, 729372.332000000402331, 0.0 ], [ 337640.541600000113249, 729375.514399999752641, 0.0 ], [ 337649.122000000439584, 729404.767599999904633, 0.0 ], [ 337664.028900000266731, 729401.585200000554323, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P46", "Shape_Leng": 91.457055487999995, "Shape_Area": 463.38228271700001 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337672.609299999661744, 729430.838500000536442, 0.0 ], [ 337664.028900000266731, 729401.585200000554323, 0.0 ], [ 337649.122000000439584, 729404.767599999904633, 0.0 ], [ 337657.702399999834597, 729434.020899999886751, 0.0 ], [ 337672.609299999661744, 729430.838500000536442, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P45", "Shape_Leng": 88.448607884799998, "Shape_Area": 417.65396871000002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337686.045099999755621, 729427.970200000330806, 0.0 ], [ 337677.464800000190735, 729398.716900000348687, 0.0 ], [ 337664.028900000266731, 729401.585200000554323, 0.0 ], [ 337672.609299999661744, 729430.838500000536442, 0.0 ], [ 337686.045099999755621, 729427.970200000330806, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P74", "Shape_Leng": 88.448415970799999, "Shape_Area": 417.65262513 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337677.464800000190735, 729398.716900000348687, 0.0 ], [ 337668.884399999864399, 729369.463700000196695, 0.0 ], [ 337655.448599999770522, 729372.332000000402331, 0.0 ], [ 337664.028900000266731, 729401.585200000554323, 0.0 ], [ 337677.464800000190735, 729398.716900000348687, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P11", "Shape_Leng": 91.456882363299997, "Shape_Area": 463.38079013499998 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337626.296099999919534, 729548.296099999919534, 0.0 ], [ 337617.715800000354648, 729519.042899999767542, 0.0 ], [ 337602.808899999596179, 729522.225199999287724, 0.0 ], [ 337611.389200000092387, 729551.478499999269843, 0.0 ], [ 337626.296099999919534, 729548.296099999919534, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P12", "Shape_Leng": 91.4569332242, "Shape_Area": 463.38209556700002 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337641.203099999576807, 729545.113700000569224, 0.0 ], [ 337632.622700000181794, 729515.860500000417233, 0.0 ], [ 337617.715800000354648, 729519.042899999767542, 0.0 ], [ 337626.296099999919534, 729548.296099999919534, 0.0 ], [ 337641.203099999576807, 729545.113700000569224, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P13", "Shape_Leng": 91.456938655100004, "Shape_Area": 463.381108385 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337656.110000000335276, 729541.931399999186397, 0.0 ], [ 337647.5296, 729512.678099999204278, 0.0 ], [ 337632.622700000181794, 729515.860500000417233, 0.0 ], [ 337641.203099999576807, 729545.113700000569224, 0.0 ], [ 337656.110000000335276, 729541.931399999186397, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P14", "Shape_Leng": 89.739948061199996, "Shape_Area": 454.45878492700001 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337671.016900000162423, 729538.748999999836087, 0.0 ], [ 337663.303299999795854, 729512.450899999588728, 0.0 ], [ 337662.357200000435114, 729512.449300000444055, 0.0 ], [ 337661.422199999913573, 729512.303700000047684, 0.0 ], [ 337660.520399999804795, 729512.017400000244379, 0.0 ], [ 337659.6727, 729511.597100000828505, 0.0 ], [ 337658.898900000378489, 729511.052500000223517, 0.0 ], [ 337658.2171, 729510.396500000730157, 0.0 ], [ 337647.5296, 729512.678099999204278, 0.0 ], [ 337656.110000000335276, 729541.931399999186397, 0.0 ], [ 337671.016900000162423, 729538.748999999836087, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P15", "Shape_Leng": 89.280366159600007, "Shape_Area": 448.588102306 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337685.923799999989569, 729535.566600000485778, 0.0 ], [ 337677.343500000424683, 729506.313300000503659, 0.0 ], [ 337668.744199999608099, 729508.14919999986887, 0.0 ], [ 337668.342400000430644, 729509.119699999690056, 0.0 ], [ 337667.78249999973923, 729510.008400000631809, 0.0 ], [ 337667.080400000326335, 729510.78969999961555, 0.0 ], [ 337666.25650000013411, 729511.441099999472499, 0.0 ], [ 337665.334300000220537, 729511.94400000013411, 0.0 ], [ 337664.340400000102818, 729512.283900000154972, 0.0 ], [ 337663.303299999795854, 729512.450899999588728, 0.0 ], [ 337671.016900000162423, 729538.748999999836087, 0.0 ], [ 337685.923799999989569, 729535.566600000485778, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P16", "Shape_Leng": 91.457008304599995, "Shape_Area": 463.382411913 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337700.830799999646842, 729532.384199999272823, 0.0 ], [ 337692.25040000025183, 729503.130999999120831, 0.0 ], [ 337677.343500000424683, 729506.313300000503659, 0.0 ], [ 337685.923799999989569, 729535.566600000485778, 0.0 ], [ 337700.830799999646842, 729532.384199999272823, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P17", "Shape_Leng": 91.456938654300004, "Shape_Area": 463.381108369 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337715.737700000405312, 729529.201899999752641, 0.0 ], [ 337707.157300000078976, 729499.948599999770522, 0.0 ], [ 337692.25040000025183, 729503.130999999120831, 0.0 ], [ 337700.830799999646842, 729532.384199999272823, 0.0 ], [ 337715.737700000405312, 729529.201899999752641, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P25", "Shape_Leng": 90.457273994600001, "Shape_Area": 468.03940542599997 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337602.30420000012964, 729515.175200000405312, 0.0 ], [ 337593.723799999803305, 729485.92200000025332, 0.0 ], [ 337578.522699999623001, 729489.167199999094009, 0.0 ], [ 337586.25870000012219, 729515.541699999943376, 0.0 ], [ 337590.036899999715388, 729517.794099999591708, 0.0 ], [ 337602.30420000012964, 729515.175200000405312, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P37", "Shape_Leng": 90.139358135099997, "Shape_Area": 468.04058540599999 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337593.723799999803305, 729485.92200000025332, 0.0 ], [ 337585.143500000238419, 729456.668700000271201, 0.0 ], [ 337572.876199999824166, 729459.287599999457598, 0.0 ], [ 337570.786700000055134, 729462.792600000277162, 0.0 ], [ 337578.522699999623001, 729489.167199999094009, 0.0 ], [ 337593.723799999803305, 729485.92200000025332, 0.0 ] ] ] ] } },
{ "type": "Feature", "properties": { "Text": "P10", "Shape_Leng": 87.130830820499995, "Shape_Area": 422.31134421799999 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 337611.389200000092387, 729551.478499999269843, 0.0 ], [ 337602.808899999596179, 729522.225199999287724, 0.0 ], [ 337592.012699999846518, 729524.529999999329448, 0.0 ], [ 337589.923200000077486, 729528.035099999979138, 0.0 ], [ 337597.659199999645352, 729554.409600000828505, 0.0 ], [ 337611.389200000092387, 729551.478499999269843, 0.0 ] ] ] ] } }
]
}
        ;

        // Global variables
        let map;
        let parcelLayers = [];
        let currentBaseLayer = 'satellite';
        let parcelStatus = {};
        
        // Initialize parcel status from localStorage or set defaults
        function initializeParcelStatus() {
            const saved = localStorage.getItem('parcelStatus');
            if (saved) {
                parcelStatus = JSON.parse(saved);
            } else {
                // Set default status for all parcels
                subdivisionData.features.forEach(feature => {
                    const parcelId = feature.properties.Text;
                    parcelStatus[parcelId] = 'available';
                });
                saveParcelStatus();
            }
        }
        
        function saveParcelStatus() {
            localStorage.setItem('parcelStatus', JSON.stringify(parcelStatus));
        }
        
        // Get parcel color based on status
        function getParcelColor(parcelId) {
            const status = parcelStatus[parcelId] || 'available';
            switch (status) {
                case 'available': return '#28a745';
                case 'reserved': return '#ffc107';
                case 'sold': return '#dc3545';
                default: return '#6c757d';
            }
        }
        
        // Initialize the map
        function initMap() {
            // Calculate bounds of the subdivision
            const bounds = L.geoJSON(subdivisionData).getBounds();
            const center = bounds.getCenter();
            
            // Create map
            map = L.map('map').setView([center.lat, center.lng], 18);
            
            // Base layers
            const mapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors'
            });
            
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles  Esri  Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            });
            
            // Add initial layer
            satelliteLayer.addTo(map);
            
            // Add parcels to map
            loadParcels();
            
            // Zoom to subdivision
            map.fitBounds(bounds, { padding: [20, 20] });
            
            // Populate admin dropdown
            populateParcelDropdown();
            
            // Hide loading screen
            document.getElementById('loading').style.display = 'none';
        }
        
        function loadParcels() {
            // Clear existing layers
            parcelLayers.forEach(layer => map.removeLayer(layer));
            parcelLayers = [];
            
            // Add each parcel as a separate layer
            subdivisionData.features.forEach(feature => {
                const parcelId = feature.properties.Text;
                const area = feature.properties.Shape_Area;
                const perimeter = feature.properties.Shape_Leng;
                const status = parcelStatus[parcelId] || 'available';
                
                const layer = L.geoJSON(feature, {
                    style: {
                        fillColor: getParcelColor(parcelId),
                        weight: 2,
                        opacity: 1,
                        color: '#ffffff',
                        dashArray: '3',
                        fillOpacity: 0.7
                    },
                    onEachFeature: function(feature, layer) {
                        // Create popup content
                        const popupContent = `
                            <div class="parcel-popup">
                                <h3> Parcel ${parcelId}</h3>
                                <p><strong> Area:</strong> ${area.toFixed(2)} sq meters</p>
                                <p><strong> Perimeter:</strong> ${perimeter.toFixed(2)} meters</p>
                                <p><strong> Status:</strong> 
                                    <span class="status-badge status-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
                                </p>
                                <p><strong> Coordinates:</strong> ${center.lat.toFixed(6)}, ${center.lng.toFixed(6)}</p>
                                <hr style="margin: 10px 0;">
                                <p style="font-size: 12px; color: #666;">
                                     Share this location:<br>
                                    <strong>GPS:</strong> ${center.lat.toFixed(6)}, ${center.lng.toFixed(6)}
                                </p>
                            </div>
                        `;
                        
                        layer.bindPopup(popupContent);
                        
                        // Highlight on hover
                        layer.on('mouseover', function() {
                            layer.setStyle({
                                weight: 4,
                                color: '#fff',
                                dashArray: '',
                                fillOpacity: 0.9
                            });
                        });
                        
                        layer.on('mouseout', function() {
                            layer.setStyle({
                                weight: 2,
                                color: '#ffffff',
                                dashArray: '3',
                                fillOpacity: 0.7
                            });
                        });
                    }
                }).addTo(map);
                
                parcelLayers.push(layer);
            });
        }
        
        function populateParcelDropdown() {
            const select = document.getElementById('parcelSelect');
            select.innerHTML = '<option value="">Select Parcel...</option>';
            
            subdivisionData.features.forEach(feature => {
                const parcelId = feature.properties.Text;
                const option = document.createElement('option');
                option.value = parcelId;
                option.textContent = `Parcel ${parcelId}`;
                select.appendChild(option);
            });
        }
        
        function toggleLayer(layerType) {
            const mapBtn = document.getElementById('mapBtn');
            const satelliteBtn = document.getElementById('satelliteBtn');
            
            // Remove current layer
            map.eachLayer(layer => {
                if (layer._url) {
                    map.removeLayer(layer);
                }
            });
            
            if (layerType === 'map') {
                const mapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ' OpenStreetMap contributors'
                }).addTo(map);
                
                mapBtn.classList.add('active');
                satelliteBtn.classList.remove('active');
                currentBaseLayer = 'map';
            } else {
                const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles  Esri  Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
                }).addTo(map);
                
                satelliteBtn.classList.add('active');
                mapBtn.classList.remove('active');
                currentBaseLayer = 'satellite';
            }
        }
        
        function locateUser() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Add user location marker
                    const userMarker = L.marker([lat, lng], {
                        icon: L.divIcon({
                            className: 'user-location',
                            html: '',
                            iconSize: [30, 30],
                            iconAnchor: [15, 15]
                        })
                    }).addTo(map);
                    
                    userMarker.bindPopup(`
                        <div class="parcel-popup">
                            <h3> Your Location</h3>
                            <p><strong>Latitude:</strong> ${lat.toFixed(6)}</p>
                            <p><strong>Longitude:</strong> ${lng.toFixed(6)}</p>
                        </div>
                    `);
                    
                    // Center map on user location
                    map.setView([lat, lng], 16);
                    
                    // Remove marker after 10 seconds
                    setTimeout(() => {
                        map.removeLayer(userMarker);
                    }, 10000);
                }, function(error) {
                    alert('Unable to get your location. Please enable location services.');
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
        
        function zoomToSubdivision() {
            const bounds = L.geoJSON(subdivisionData).getBounds();
            map.fitBounds(bounds, { padding: [20, 20] });
        }
        
        function selectParcel() {
            const select = document.getElementById('parcelSelect');
            const statusSelect = document.getElementById('statusSelect');
            const parcelId = select.value;
            
            if (parcelId) {
                // Update status dropdown to current parcel status
                statusSelect.value = parcelStatus[parcelId] || 'available';
                
                // Find and highlight the parcel
                const feature = subdivisionData.features.find(f => f.properties.Text === parcelId);
                if (feature) {
                    const bounds = L.geoJSON(feature).getBounds();
                    map.fitBounds(bounds, { padding: [50, 50] });
                    
                    // Find and open popup for this parcel
                    parcelLayers.forEach(layer => {
                        layer.eachLayer(sublayer => {
                            if (sublayer.feature && sublayer.feature.properties.Text === parcelId) {
                                sublayer.openPopup();
                            }
                        });
                    });
                }
            }
        }
        
        function updateParcelStatus() {
            const parcelSelect = document.getElementById('parcelSelect');
            const statusSelect = document.getElementById('statusSelect');
            const parcelId = parcelSelect.value;
            const newStatus = statusSelect.value;
            
            if (parcelId) {
                // Update status
                parcelStatus[parcelId] = newStatus;
                saveParcelStatus();
                
                // Reload parcels to update colors
                loadParcels();
                
                // Show success message
                const popup = L.popup()
                    .setLatLng(map.getCenter())
                    .setContent(`
                        <div class="parcel-popup">
                            <h3> Status Updated</h3>
                            <p>Parcel ${parcelId} is now marked as <strong>${newStatus}</strong></p>
                        </div>
                    `)
                    .openOn(map);
                
                setTimeout(() => {
                    map.closePopup();
                }, 3000);
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeParcelStatus();
            initMap();
        });
        
        // Share functionality
        function shareLocation(parcelId) {
            const feature = subdivisionData.features.find(f => f.properties.Text === parcelId);
            if (feature) {
                const bounds = L.geoJSON(feature).getBounds();
                const center = bounds.getCenter();
                const url = `${window.location.origin}${window.location.pathname}?parcel=${parcelId}&lat=${center.lat}&lng=${center.lng}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: `Coral Subdivision - Parcel ${parcelId}`,
                        text: `Check out this parcel in Coral Subdivision`,
                        url: url
                    });
                } else {
                    // Fallback - copy to clipboard
                    navigator.clipboard.writeText(url).then(() => {
                        alert('Location link copied to clipboard!');
                    });
                }
            }
        }
        
        // Handle URL parameters for direct parcel access
        function handleUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const parcelId = urlParams.get('parcel');
            const lat = urlParams.get('lat');
            const lng = urlParams.get('lng');
            
            if (parcelId && lat && lng) {
                // Wait for map to load, then zoom to specific parcel
                setTimeout(() => {
                    map.setView([parseFloat(lat), parseFloat(lng)], 19);
                    document.getElementById('parcelSelect').value = parcelId;
                    selectParcel();
                }, 1000);
            }
        }
        
        // Call after map initialization
        setTimeout(handleUrlParams, 1500);
    </script>
</body>
</html>
